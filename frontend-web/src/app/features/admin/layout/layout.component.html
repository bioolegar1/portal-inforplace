<div class="min-h-screen bg-gray-50 dark:bg-slate-950 flex transition-colors duration-300">

  <aside
    class="fixed inset-y-0 left-0 z-50 bg-slate-900 dark:bg-slate-950 text-white transition-all duration-300 ease-in-out shadow-xl border-r border-transparent dark:border-slate-800
           md:translate-x-0 flex flex-col"
    [class.translate-x-0]="mobileMenuOpen()"
    [class.-translate-x-full]="!mobileMenuOpen()"
    [class.w-64]="sidebarOpen()"
    [class.w-20]="!sidebarOpen()"
    [class.md:w-20]="!sidebarOpen()"
  >
    <div class="flex items-center h-16 px-4 border-b border-slate-800 bg-slate-950"
         [class.justify-center]="!sidebarOpen()"
         [class.justify-between]="sidebarOpen()">

      @if (sidebarOpen()) {
        <div class="flex items-center gap-3 fade-in">
          <div class="w-8 h-8 bg-blue-600 rounded flex items-center justify-center font-bold text-white shadow-lg shadow-blue-900/20">IP</div>
          <div>
            <h1 class="font-bold text-lg leading-none tracking-tight">Inforplace</h1>
            <span class="text-xs text-slate-400 font-medium">Admin Panel</span>
          </div>
        </div>
      }

      @if (!sidebarOpen()) {
        <div class="w-8 h-8 bg-blue-600 rounded flex items-center justify-center font-bold text-white shadow-lg">IP</div>
      }

      <button (click)="toggleMobileMenu()" class="md:hidden text-slate-400 hover:text-white transition-colors">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </div>

    <nav class="flex-1 px-3 py-4 space-y-2 overflow-y-auto custom-scrollbar">
      @for (item of menuItems; track item.route) {
        <a
          [routerLink]="item.route"
          routerLinkActive="bg-blue-600 text-white shadow-md shadow-blue-900/20"
          class="flex items-center gap-3 px-3 py-3 rounded-lg hover:bg-slate-800 dark:hover:bg-slate-900 transition-all duration-200 group relative cursor-pointer text-slate-300 hover:text-white"
          (click)="mobileMenuOpen.set(false)"
        >
          <svg class="w-6 h-6 flex-shrink-0 transition-colors duration-200"
               [class.text-white]="sidebarOpen()"
               fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" [attr.d]="getIconSvg(item.icon)"/>
          </svg>

          @if (sidebarOpen()) {
            <span class="flex-1 font-medium whitespace-nowrap overflow-hidden fade-in">{{ item.label }}</span>

            @if (item.badge) {
              <span class="bg-rose-500 text-white text-xs font-bold px-2 py-0.5 rounded-full shadow-sm">{{ item.badge }}</span>
            }
          }
          @else {
            <div class="absolute left-14 ml-2 px-3 py-1.5 bg-slate-800 text-white text-xs font-medium rounded-md shadow-xl opacity-0 group-hover:opacity-100 pointer-events-none transition-all duration-200 z-50 whitespace-nowrap border border-slate-700">
              {{ item.label }}
            </div>
          }
        </a>
      }
    </nav>

    <div class="p-4 border-t border-slate-800 bg-slate-900 dark:bg-slate-950">
      @if (sidebarOpen()) {
        <div class="flex items-center gap-3 fade-in">
          <div class="w-9 h-9 rounded-full bg-gradient-to-tr from-slate-700 to-slate-600 flex items-center justify-center text-sm font-bold border border-slate-600 shadow-sm">
            {{ authService.currentUser()?.name?.charAt(0) || 'A' }}
          </div>
          <div class="flex-1 min-w-0">
            <p class="text-sm font-medium text-white truncate">{{ authService.currentUser()?.name }}</p>
            <p class="text-xs text-slate-400 truncate">{{ authService.currentUser()?.email }}</p>
          </div>
          <button (click)="logout()" class="text-slate-400 hover:text-rose-500 transition-colors p-1 rounded hover:bg-slate-800" title="Sair">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
          </button>
        </div>
      } @else {
        <button (click)="logout()" class="w-full flex justify-center text-slate-400 hover:text-rose-500 transition-colors py-2 rounded hover:bg-slate-800" title="Sair">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
        </button>
      }
    </div>
  </aside>

  @if (mobileMenuOpen()) {
    <div
      class="fixed inset-0 bg-black/60 z-40 md:hidden backdrop-blur-sm transition-opacity"
      (click)="toggleMobileMenu()"
    ></div>
  }

  <div class="flex-1 flex flex-col min-h-screen transition-all duration-300 ease-in-out"
       [class.md:ml-64]="sidebarOpen()"
       [class.md:ml-20]="!sidebarOpen()">

    <header class="h-16 bg-white dark:bg-slate-900 border-b border-gray-200 dark:border-slate-800 shadow-sm flex items-center justify-between px-6 sticky top-0 z-30 transition-colors duration-300">

      <div class="flex items-center gap-4">
        <button (click)="toggleSidebar()" class="hidden md:flex p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-800 text-gray-600 dark:text-slate-400 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
        </button>

        <button (click)="toggleMobileMenu()" class="md:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-800 text-gray-600 dark:text-slate-400 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
        </button>

        <h2 class="text-xl font-semibold text-gray-800 dark:text-white hidden sm:block tracking-tight">
          Painel Administrativo
        </h2>
      </div>

      <div class="flex items-center gap-3 md:gap-6">

        <button
          (click)="toggleTheme()"
          class="p-2 rounded-full text-gray-500 hover:bg-gray-100 dark:text-slate-400 dark:hover:bg-slate-800 dark:hover:text-yellow-400 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-slate-900"
          title="Alternar Tema">

          @if (isDarkMode()) {
            <svg class="w-6 h-6 animate-spin-slow" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
          }
          @if (!isDarkMode()) {
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg>
          }
        </button>

        <div class="h-6 w-px bg-gray-200 dark:bg-slate-700 mx-1 hidden sm:block"></div>

        <a href="/" target="_blank" class="text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 flex items-center gap-1.5 px-3 py-1.5 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors">
          Ver Site
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
        </a>
      </div>
    </header>

    <main class="p-6 md:p-8 flex-1 overflow-x-hidden">
      <router-outlet></router-outlet>
    </main>
  </div>

</div>

<style>
  .fade-in { animation: fadeIn 0.3s ease-in-out; }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  .animate-spin-slow { animation: spin 3s linear infinite; }
  @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
  .custom-scrollbar::-webkit-scrollbar { width: 4px; }
  .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
  .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
  .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #475569; }
</style>
